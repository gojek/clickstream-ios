name: "Clickstream CI"

on: [push, workflow_dispatch]

jobs:
  RunTests:
    name: "Unit Tests"
    runs-on: macos-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
        
      - name: Set up ruby environment
        uses: ruby/setup-ruby@v1
        with:
         ruby-version: 3.2.4 # omit if .ruby-version file exists in project, or replace with your teamâ€™s supported ruby version
         bundler-cache: true

      - name: Setup latest Xcode
        uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: '16.4'

      - name: Cache CocoaPods
        uses: actions/cache@v3
        with:
          path: |
            ~/.cocoapods/repos
            Pods
          key: ${{ runner.os }}-pods-${{ hashFiles('**/Podfile.lock') }}
          restore-keys: |
            ${{ runner.os }}-pods-

      - name: Clean derived data
        run: bundle exec fastlane clean

      - name: Pod installl
        run: bundle exec fastlane pod_install

      - name: Testing Clickstream
        run: bundle exec fastlane unit_test
