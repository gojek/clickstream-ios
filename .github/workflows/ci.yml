name: "Clickstream CI"

on: [push, workflow_dispatch]

# Allows you to run this workflow manually from the Actions tab
  # workflow_dispatch:

jobs:
  RunTests:
    name: "Unit Tests"
    runs-on: macos-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Set up ruby environment
        uses: ruby/setup-ruby@v1
        with:
         bundler-cache: true
    
      - name: Load Xcode version
        uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: '16.4'
  
      - name: Cache CocoaPods
        uses: actions/cache@v3
        with:
          path: |
            Pods
            ~/Library/Caches/CocoaPods
            ~/Library/Developer/Xcode/DerivedData
          key: ${{ runner.os }}-pods-${{ hashFiles('Podfile.lock') }}
          restore-keys: |
            ${{ runner.os }}-pods-
  
      - name: Verify environment
        run: |
          echo "Ruby version: $(ruby --version)"
          echo "Bundler version: $(bundle --version)"
          echo "Working directory: $(pwd)"
          echo "Xcode version: $(xcodebuild -version)"
          echo "Xcode path: $(xcode-select -p)"
          echo "Available Xcode versions:"
          ls /Applications/ | grep -i xcode
          bundle list
        shell: bash
  
      - name: Testing Clickstream
        run: bundle exec fastlane unit_test
      